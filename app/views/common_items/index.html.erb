<% @title = @group.name %>
<% @page_action = link_to("Add new item", new_group_common_item_path(:group_id => @group.id)) %>

<div id="group_show">
  <%= render :partial => "groups/group_details" %>
  <div style="overflow-x: scroll">
    <span style="float:left;"><%= page_entries_info(@common_items,  :entry_name => 'items') %></span>
    <span class="pagination_details"><%= will_paginate @common_items %></span>
    <br>
    <table id="common_items_table" border="1" rules="all">
      <tr class="header">
        <th>Item Name</th>
        <th>Cost (paid by)</th>
        <% @group.users.each do |user| %>
          <th><%= user.display_name %></th>
        <% end %>
        <th class='date'>Transaction Date</th>
      </tr>
      <tr>
        <% form_for([:group, @new_common_item]) do |f| %>
          <%= hidden_field_tag :index, true %>
          <td><%= f.text_field :name, :size => 20 %></td>
          <td><%= f.text_field :cost, :size => 5, :disabled => true, :style => "border-color: white;" %></td>
          <% @group.users.each do |user| %>
            <td><%= text_field :item_cost, user.id, :size => 5, :onkeyup => "CommonItem.update_cost()", :onblur => "CommonItem.update_cost()",
                               :onclick => "CommonItem.update_cost()", :onkeydown => "CommonItem.update_cost()" %></td>
          <% end %>
          <td>
            <%= calendar_input_tag(:common_item, :transaction_date, :form => f) %>
            <%= f.submit "Create", :onclick => "return CommonItem.update_final_cost()", :class => "button" %>
          </td>
        <% end %>
      </tr>
      <% @common_items.each do |common_item| %>
        <tr>
          <td><%= common_item.name %>&nbsp;&nbsp;<small><%= show_delete_link(common_item)%></small></td>
          <td style="color:red;">Rs.<%= common_item.cost %> (<%= common_item.user.display_name %>)</td>
          <% @group.users.each do |user| %>
            <td><%= display_amount(user, common_item) %></td>
          <% end %>
          <td><small><%= common_item.transaction_date.strftime('%b, %d %Y') %></small></td>
        </tr>
      <% end %>
      <% if @is_full_view %>
        <tr class="full_stats">
          <td>Total expenditure</td>
          <td>Rs.<%= @total_cost %></td>
          <% @group.users.each do |user| %>
            <td>Rs.<%= @group.get_group_user(user).items.collect(&:default_amount).sum %></td>
          <% end %>
          <td><small><%= Time.now.strftime('%b, %d %Y') %></small></td>
        </tr>
      <% end %>
    </table>
    <span style="float:right;"><%= will_paginate @common_items %></span>
  </div>
</div>

<script>
  <% @group.users.each_with_index do |u, i| %>
    CommonItem.elements[<%= i %>] = $('item_cost_<%= u.id %>')
  <% end %>
</script>